<!DOCTYPE html>
<html>
	<head>
		<title>Troca de Livros</title>

		<% include ../snippets/head %>
	</head>
	<body>
		<% include ../snippets/navbar %>

		<div class="ui container" id="top">
			<% if(message.length > 0) { %>
				<div class="ui text container">
					<div class="ui message">
						<i class="close icon"></i>
						<div class="header">
							Done!
						</div>
						<p><%= message %></p>
					</div>
				</div>
			<% } %>

			<div class="ui raised segments styled fluid accordion">
				<% var hasPendingRequests = !(!requested || 0 === requested.length || requested === "") %>
				<div class="title">
					<i class="dropdown icon"></i>
					Pending requests
					<% if(hasPendingRequests) { %>
						<div class="horizontal ui red label">
							<%= requested.length %>
						</div>
					<% } %>
				</div>
				<div class="content">
					<div class="ui relaxed divided items">
						<% if(!hasPendingRequests) { %>
							<div class="item">
								<div class="content">
									<a class="header">
										<span>Woops!</span>
									</a>
									<div class="meta">
										<span>No user has requested a book from you... yet!</span>
									</div>
									<div class="description">
										<p>
											Have you tried adding more? Click the add button!
										</p>
									</div>
									<div class="extra">
										<a class="ui left floated positive button" href="/profile/add/book">
											<i class="plus icon"></i>
											Add Book
										</a>
									</div>
								</div>
							</div>
						<% } else { %>
							<!--Show all requests -->
							<div class="item">
								<p><%= requested %></p>
							</div>
						<% } %>
					</div>
				</div>

				<% var hasOwnedBooks = !(!user.books || 0 === user.books.length || user.books === "") %>
				<div class="title">
					<i class="dropdown icon"></i>
					User owned books

					<% if(hasOwnedBooks) { %>
						<div class="horizontal ui teal label">
							<%= user.books.length %>
						</div>
					<% } %>
				</div>
				<div class="content">
					<% if(!hasOwnedBooks) { %>
						<div class="ui items">
							<div class="item">
								<div class="content">
									<a class="header">
										<span>Woops!</span>
									</a>
									<div class="meta">
										<span>You have not added any books yet..</span>
									</div>
									<div class="description">
										<p>
											To start adding books to your collection, click the add button!
										</p>
									</div>
									<div class="extra">
										<a class="ui left floated positive button" href="/profile/add/book">
											<i class="plus icon"></i>
											Add Book
										</a>
									</div>
								</div>
							</div>
						</div>
					<% } else { %>
						<!-- Show all books -->
						<!-- Only show 6 books, rest go to user library -->
						<div class="ui centered doubling cards">
							<% for (var i = 0; i < user.books.length && i < 6; i++) { %>
								<div class="card">
									<div class="content">
										<i class="right floated delete icon"></i>
										<div class="header">
											<a href="/book/<%= user.books[i].link %>"><%= user.books[i].title %></a>
										</div>

										<div class="meta"><%= user.books[i].book %></div>
									</div>
									<div class="extra content">
										<div class="description">
											<% if(user.books[i].description) { %>
												<% if(user.books[i].description.length > 150) { %>
													<p>
														<%= user.books[i].description.substring(0,150) %>&hellip;
													</p>
												<% } else { %>
													<p>
														<%= user.books[i].description %>
													</p>
												<% } %>
											<% } %>
										</div>
									</div>
								</div>
							<% } %>
						</div>
					<% } %>
				</div>

				<div class="active title">
					<i class="dropdown icon"></i>
					User Settings
				</div>
				<div class="active content">
					<form class="ui equal width form" action="/profile/update" method="post">
						<div class="ui stackable grid segment">
							<div class="middle aligned center aligned four wide column">
								<div class="ui medium circular bordered image" id="imgdim">
									<div class="ui dimmer">
										<div class="content">
											<div class="center">
												<a href="http://www.gravatar.com" target="_blank" class="ui blue button">
													Gravatar
												</a>
											</div>
										</div>
									</div>
									<img src="<%= user.picture %>"/>
								</div>
							</div>
							<div class="twelve wide column">
								<div class="fields">
									<div class="field">
										<% if(user.picture == undefined || user.picture === "/img/profile.jpg" || user.picture.includes('//www.gravatar.com')) { %>
											<label>Picture
												<a class="horizontal ui teal label" href="http://www.gravatar.com" target="_blank">Using Gravatar</a>
											</label>

											<input type="text" placeholder="Your picture url" name="picture">
										<% } else { %>
											<label>Picture</label>
											<input type="text" placeholder="Your picture url" name="picture" value="<%= user.picture %>">
										<% } %>
									</div>
									<div class="field">
										<label>E-mail</label>
										<input required type="email" placeholder="User e-mail" name="email" value="<%= user.email %>" readonly="">
									</div>
								</div>
								<div class="fields">
									<div class="field">
										<label>City</label>
										<input type="text" placeholder="User city" name="city" value="<%= user.city %>">
									</div>
									<div class="field">
										<label>Phone</label>
										<input type="tel" placeholder="User phone number" name="phone" value="<%= user.phone %>">
									</div>
								</div>
								<div class="inline fields">
									<div class="field">
										<div class="ui checkbox">
											<label for="publicInformation">Show Phone Number</label>
											<input class="hidden" tabindex="0" type="checkbox" name="publicInformation" <% if(user.configs.publicInformation) {%> checked <% } %>/>
										</div>
									</div>
									<!--<div class="field">
										<div class="ui disabled checkbox">
											<label for="showSocialMedia">Show Social Media</label>
											<input class="hidden" tabindex="0" type="checkbox" name="showSocialMedia"/>
										</div>
									</div>-->
									<div class="field">
										<div class="ui checkbox">
											<label for="hideDescription">Hide description</label>
											<input class="hidden" tabindex="0" type="checkbox" name="hideDescription" <% if(user.configs.hideDescription) {%> checked <% } %>/>
										</div>
									</div>
									<div class="field">
										<div class="ui selection dropdown">
											<input type="hidden" name="theme">
											<i class="dropdown icon"></i>
											<div class="default text">
												Default Theme
											</div>
											<div class="menu">
												<div class="item" data-value="1">Default Theme</div>
												<div class="item" data-value="2">Deep Blush</div>
												<div class="item" data-value="3">Dark Theme</div>
											</div>
										</div>
									</div>
								</div>
								<div class="fields">
									<div class="field">
										<label>Description</label>
										<textarea rows="3" style="margin-top: 0px; margin-bottom: 0px; height: 128px;" name="description" placeholder="Description"><%= user.description %></textarea>
									</div>
								</div>
								<div class="fields">
									<div class="field">
										<button class="ui fluid green button" type="submit" value="update" name="update">Update Information</button>
									</div>
									<div class="field">
										<div class="fields">
											<div class="field">
												<button class="ui fluid orange disabled button" type="submit" value="deletebooks" name="update" onclick="return confirm('Are you sure you want to delete all books? There is no going back.')">Delete all books</button>
											</div>
											<div class="field">
												<button class="ui fluid negative button" type="submit" value="deleteaccount" name="update" onclick="return confirm('Are you sure you want to delete your account? There is no going back.')">Delete account</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>

		<% include ../snippets/footer %>
		<% include ../snippets/JS %>
		<script src="/js/profile.authenticated.js"></script>
		<script type="text/javascript">
			$('.selection.dropdown').dropdown('set selected', <%= user.configs.theme %>);
		</script>
	</body>
</html>
